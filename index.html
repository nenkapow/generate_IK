<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Generator IK TIGER ‚Üí DOCX</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --soft:#020617;
      --fg:#e5e7eb; --fg-dim:#9ca3af;
      --accent:#f97316; --border:#1f2937;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,sans-serif}
    body{margin:0;background:var(--bg);color:var(--fg);}
    h1{font-size:1.4rem;margin:0 0 .75rem}
    .wrap{max-width:1100px;margin:0 auto;padding:1rem;}
    .card{background:var(--panel);border-radius:.75rem;padding:1rem;margin-bottom:1rem;border:1px solid var(--border);}
    label{font-size:.85rem;color:var(--fg-dim);display:block;margin-bottom:.15rem;}
    input,textarea,button{
      font-size:.85rem;border-radius:.5rem;border:1px solid var(--border);
      background:var(--soft);color:var(--fg);padding:.4rem .5rem;
    }
    textarea{width:100%;min-height:70px;resize:vertical;}
    input[type="text"]{width:100%;}
    input[type="number"]{width:80px;}
    button{
      cursor:pointer;background:var(--accent);border-color:var(--accent);
      color:#0b1120;font-weight:600;
    }
    button:disabled{opacity:.5;cursor:not-allowed;}
    .row{display:flex;flex-wrap:wrap;gap:.75rem;}
    .row > div{flex:1;min-width:180px;}
    .small{font-size:.75rem;color:var(--fg-dim);}
    .step-card,.img-card{
      border:1px solid var(--border);border-radius:.5rem;padding:.5rem;margin-top:.5rem;
      background:var(--soft);
    }
    .step-header,.img-header{
      display:flex;align-items:center;justify-content:space-between;gap:.5rem;
      font-size:.8rem;color:var(--fg-dim);margin-bottom:.3rem;
    }
    hr{border:none;border-top:1px solid var(--border);margin:.75rem 0;}
    @media(max-width:768px){
      .row{flex-direction:column;}
      input[type="number"]{width:100%;}
    }
  </style>
  <!-- library DOCX di browser -->
  <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Generator Instruksi Kerja TIGER ‚Üí DOCX</h1>
    <div class="small">
      ‚Ä¢ Header, border, dan layout mengikuti template standar TIGER.<br>
      ‚Ä¢ Simpan logo sebagai <code>logo-tiger.png</code> di folder yang sama dengan file ini.<br>
      ‚Ä¢ Setelah klik <strong>Generate DOCX</strong>, file Word akan ter-download dan bisa kamu edit lagi.
    </div>
  </div>

  <!-- DATA HEADER -->
  <div class="card">
    <h2 style="font-size:1rem;margin-top:0;">1. Header Dokumen</h2>
    <div class="row">
      <div>
        <label>Judul Dokumen (tengah)</label>
        <input id="docTitle" type="text" placeholder="INSTRUKSI KERJA PRINTING LC 002 BASE">
      </div>
      <div>
        <label>Nomor Dokumen</label>
        <input id="docNumber" type="text" placeholder="IK/PRO-TP/163">
      </div>
      <div>
        <label>Revisi</label>
        <input id="docRev" type="text" value="00">
      </div>
      <div>
        <label>Tanggal Efektif</label>
        <input id="docDate" type="text" placeholder="16 November 2015">
      </div>
    </div>
  </div>

  <!-- BAGIAN SISTEM MUTU -->
  <div class="card">
    <h2 style="font-size:1rem;margin-top:0;">2. Sistem Manajemen Mutu</h2>
    <div class="small">Bagian judul dan tabel sudah default. Kamu hanya isi teks di bawah ini.</div>
    <label>Ruang Lingkup</label>
    <textarea id="scope" placeholder="Dimulai dari produk hasil injection sampai dipacking di box WIP."></textarea>

    <label style="margin-top:.5rem;">Referensi (satu baris = satu butir)</label>
    <textarea id="refs" placeholder="ISO 9001:2015 pasal 8.5.1&#10;ISO 9001:2015 pasal 8.5.2"></textarea>
  </div>

  <!-- LANGKAH KERJA -->
  <div class="card">
    <h2 style="font-size:1rem;margin-top:0;">3. Langkah Kerja & Visual</h2>
    <div class="small">
      ‚Ä¢ Di dokumen Word nanti dibuat tabel 2 kolom: <strong>Deskripsi</strong> dan <strong>Visual</strong>.<br>
      ‚Ä¢ Satu ‚ÄúLangkah‚Äù di sini = satu nomor langkah (1,2,3,...) di kolom deskripsi.  
      ‚Ä¢ Nomor gambar kamu isi sendiri (misal: <code>1,2,3</code> atau <code>5-7</code>).
    </div>
    <div id="stepsContainer"></div>
    <button type="button" onclick="addStep()">+ Tambah Langkah</button>

    <hr>

    <h3 style="font-size:.95rem;">Gambar Visual</h3>
    <div class="small">
      ‚Ä¢ Urutkan sesuai kebutuhan (1 sampai 9 misalnya).  
      ‚Ä¢ ‚ÄúLabel angka‚Äù akan ditulis di atas gambar (contoh di template kamu: <code>1,2,3</code> ‚Äì <code>4.</code> ‚Äì dll).
    </div>
    <div id="imagesContainer"></div>
    <button type="button" onclick="addImageInput()">+ Tambah Gambar</button>
  </div>

  <!-- TANDA TANGAN -->
  <div class="card">
    <h2 style="font-size:1rem;margin-top:0;">4. Tanda Tangan</h2>
    <div class="row">
      <div>
        <label>Nama Dibuat</label>
        <input id="signCreated" type="text" placeholder="">
        <div class="small">Jabatan fix: Production Supervisor</div>
      </div>
      <div>
        <label>Nama Diperiksa</label>
        <input id="signChecked" type="text" placeholder="">
        <div class="small">Jabatan fix: Admin Production</div>
      </div>
      <div>
        <label>Nama Disetujui</label>
        <input id="signApproved" type="text" placeholder="Musana">
        <div class="small">Jabatan fix: Factory Manager</div>
      </div>
    </div>
  </div>

  <!-- ACTION -->
  <div class="card" style="text-align:right;">
    <button type="button" onclick="generateDoc()">Generate DOCX</button>
  </div>
</div>

<script>
  // -------- UI helper: langkah & gambar ----------
  let stepCounter = 0;
  let imgCounter = 0;

  function addStep() {
    stepCounter++;
    const wrap = document.getElementById("stepsContainer");
    const div = document.createElement("div");
    div.className = "step-card";
    div.dataset.stepId = stepCounter;

    div.innerHTML = `
      <div class="step-header">
        <span>Langkah #${stepCounter}</span>
        <button type="button" onclick="this.closest('.step-card').remove()">hapus</button>
      </div>
      <label>Deskripsi langkah</label>
      <textarea data-role="step-desc"></textarea>
    `;
    wrap.appendChild(div);
  }

  function addImageInput() {
    imgCounter++;
    const wrap = document.getElementById("imagesContainer");
    const div = document.createElement("div");
    div.className = "img-card";
    div.dataset.imgId = imgCounter;

    div.innerHTML = `
      <div class="img-header">
        <span>Gambar #${imgCounter}</span>
        <button type="button" onclick="this.closest('.img-card').remove()">hapus</button>
      </div>
      <div class="row">
        <div>
          <label>File gambar</label>
          <input type="file" accept="image/*" data-role="img-file">
        </div>
        <div>
          <label>Label angka di atas gambar</label>
          <input type="text" placeholder="1,2,3" data-role="img-label">
        </div>
      </div>
    `;
    wrap.appendChild(div);
  }

  // Tambah default 1 langkah + 1 gambar
  addStep();
  addImageInput();

  // --------- Generate DOCX ----------
  async function generateDoc() {
    // pastikan library docx sudah ke-load
    if (!window.docx) {
      alert("Library DOCX belum ke-load.\n" +
            "Pastikan PC terhubung internet dan tidak memblokir https://unpkg.com.");
      return;
    }

    // baru ambil object dari library
    const {
      Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell,
      WidthType, AlignmentType, BorderStyle, Media
    } = window.docx;

    const title = document.getElementById("docTitle").value || "INSTRUKSI KERJA";
    const number = document.getElementById("docNumber").value || "IK/PRO-TP/XXX";
    const rev = document.getElementById("docRev").value || "00";
    const effDate = document.getElementById("docDate").value || "";

    const scope = document.getElementById("scope").value.trim();
    const refsRaw = document.getElementById("refs").value.trim();

    const signCreated = document.getElementById("signCreated").value || "";
    const signChecked = document.getElementById("signChecked").value || "";
    const signApproved = document.getElementById("signApproved").value || "Musana";

    const doc = new Document({
      sections: [],
      creator: "Generator IK TIGER",
    });

    // === sisanya PERSIS sama seperti script yang aku kasih sebelumnya ===
    // (headerTable, section 1, section 2, dll)
    // tinggal copy blok kode generateDoc lama mulai dari:
    //   // ---- HEADER TABLE (3 kolom) ----
    // sampai sebelum:
    //   const blob = await Packer.toBlob(doc);
    // dan tempel di sini, menggantikan bagian titik-titik ini.
    // ====================================
    // (kalo bingung, aku bisa kirim ulang full generateDoc yang sudah disatukan üòä)

    // ---- export ----
    const blob = await Packer.toBlob(doc);
    const fileNameSafe = (title || "Instruksi Kerja").replace(/[\\/:*?"<>|]/g,"_");
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = fileNameSafe + ".docx";
    a.click();
    URL.revokeObjectURL(a.href);
  }
</script>
</body>
</html>
